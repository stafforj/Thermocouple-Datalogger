# Build Instructions and Notes

### Operating Principles

Thermocouples measure temperature at a junction between two dissimilar metals/conductors using the [Seebeck effect](https://en.wikipedia.org/wiki/Thermocouple). In thermocouple acquisition systems, there are two main requirements. Firstly, the voltage generated by the hot junction temperature of the thermocouple is low and requires amplification. Secondly, this voltage does not provide a reading of temperature by itself. Absolute temperature measurements at the hot junction are obtained using a reference sensor that measures a known temperature. This is known as cold junction compensation. In this build, we use the MAX31855 amplifier which includes cold junction compensation. This is designed for Type-K thermocouples and -200°C to +1350°C output in 0.25°C increments. We connect multiple amplifiers to a prototype HAT (Hardware Attached on Top) that can mount directly onto the header of a Raspberry Pi single board computer. This is then used to communicate with the hardware through the GPIO, record the measurements, and display the temperatures in real-time on a computer screen.


## Bill of Materials

|Name               |QTY|Description                           |
|:------------------|:-:|:-------------------------------------|
|[Raspberry Pi](https://uk.farnell.com/raspberry-pi/rpi3-modbp/sbc-board-raspberry-pi-3-model/dp/2842228?src=raspberrypi)|1  |Raspberry Pi 3B+ single board computer. |
|[PCB HAT](https://www.adafruit.com/product/2310)|1  |Adafruit Perma-Proto HAT without EEPROM.|
|[Raspberry Pi Case](https://uk.rs-online.com/web/p/raspberry-pi-cases/9098132)|1 |Case for RPi and thermocouple HAT.| 
|[Thermocouple Amplifier](https://www.adafruit.com/product/269)|3  |MAX31855 thermocouple amplifier board for Type-K thermocouples.|
|[Thermocouple connectors](https://uk.rs-online.com/web/p/sensor-accessories/8919031)|3  |For quick connection of thermocouples to datalogger.|
|[Thermocouple cable](https://uk.rs-online.com/web/p/thermocouple-extension-wire/2363959)|1  |Length depending on requirements.|
|Thermocouples|3  |Type-K thermocouples to suit the application.|
|Misc.|   | <ul><li>Wiring</li><li>Soldering Iron and solder</li><li>Small screwdriver</li></ul>|


## Wiring

### Thermocouple Amplifier to PCB HAT

To be added.

![Circuit schematic](./Images/TC-HAT-Schematic.png)

![Thermocouple HAT for RPi](./Images/amplifiers-to-HAT-wiring.png)

### Thermocouple HAT to RPi and Thermocouple connectors

To be added

![Thermocouple HAT on RPi](./Images/TC-HAT-on-pi.png)

![Enclosure and connector installation](./Images/assembled-with-connectors.png)




## Python Codes

The 

### Temperature acquisition
The python code for aquiring temperature measurements from the thermocouples is located in `/Code/temperatureLog.py`. 

### Live plot of temperatures
The python code for plotting the temperature measurements from the thermocouples in real-time is located in `/Code/liveSubPlot.py`.


The arduino code for uploading to the Arduino UNO microcontroller is located in `/Code/relay-switch.ino`. This contains a routine which turns the relay from the default open circuit (Normally-Open) to closed circuit where the outlet plug will be energised with AC from the source (in our case, single-phase 240VAC).

First, the signal pin is set as an output. Here, we use `LED_BUILTIN` as the signal pin which is pin 13 on the Arduino UNO.

```
void setup() {
  pinMode(LED_BUILTIN, OUTPUT);
}
```

The remainder of the code involves setting up the time intervals and switching duration. These define how long the relay will switch `on` and `off` for (in milliseconds). And the switching duration is expressed by a total ON time `t` which is limited in the for loop to be less than a user-defined value (e.g., `t<1800000`). The relay is actuated by sending pin 13 `HIGH` (5VDC) and returned to NO by sending pin 13 `LOW`. In this example, the AC circuit is energised for 1 minute, turns off for 2 minutes, and will operate for a total ON time of 30 minutes. Once this target duration of 30 mins is reached, the loop exits and the relay returns to the default NO state permanently.   

```
void loop() {
  long on=60000;      
  long off=120000;    

  for (long t=0; t<1800000; t=t+on) {    
    digitalWrite(LED_BUILTIN, HIGH);    
    delay(on);                          
    digitalWrite(LED_BUILTIN, LOW);     
    delay(off);                         
    Serial.println(""); 
   }
  
  exit(0); 
```


